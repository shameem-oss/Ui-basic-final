"use strict";(self.webpackChunkSHEIN_W=self.webpackChunkSHEIN_W||[]).push([[70827],{870827:function(e,t,n){n.d(t,{JB:function(){return re},p:function(){return de},Fr:function(){return M},Xy:function(){return R},Mi:function(){return le},dm:function(){return he}});var i=n(659015),s=n(14900),r=n(665640),o=Object.defineProperty,a=(e,t,n)=>(((e,t,n)=>{t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);const l=e=>{var t;if("undefined"==typeof window)return null;return{container:e.scrollContainer?e.scrollContainer instanceof HTMLElement?e.scrollContainer:document.querySelector(e.scrollContainer):window,key:[null==(t=e.mask)?void 0:t.map((e=>parseFloat(String(e)))).join(""),e.delay,e.exposeRatio,e.observeHide?"obHide":""].join("")}},d={cache:new Map,get(e){const t=(this.cache.get(e.container)||[]).find((t=>t.key==e.key));return t?t.instance:null},set(e){const t=this.cache.get(e.container)||[];t.find((t=>t.key==e.key))||(t.push({key:e.key,instance:e.instance}),this.cache.set(e.container,t))},del(e){if(e.key){const t=this.cache.get(e.container)||[],n=t.findIndex((t=>t.key==e.key));t.splice(n,1),t.length?this.cache.set(e.container,t):this.cache.delete(e.container)}else this.cache.delete(e.container)}},c={IDKEY:"da-eid",REPEATKEY:"da-rid"},u=e=>{if("undefined"==typeof window||!e)return"";if("string"==typeof e)return e;if(e instanceof HTMLElement){const t=e.getAttribute(c.IDKEY);return`[${c.IDKEY}=${t}]`}if((0,i.G)(e))return e.target instanceof HTMLElement?{code:(null==e?void 0:e.code)||"",target:u(e.target)}:e;if(e.length){const t=e[0].classList;return Array.prototype.map.call(t,(e=>`.${e}`)).join("")}return""},h=e=>"undefined"!=typeof window&&e?e instanceof HTMLElement?[e]:"string"==typeof e?Array.prototype.slice.call(document.querySelectorAll(e)):(0,i.G)(e)?h(e.target):e.length?Array.prototype.slice.call(e):[e]:[],p=()=>Number(Math.random().toString().substr(3,3)+Date.now()).toString(36),g=(e,t)=>{let n;switch(e){case"error":n=r.error;break;case"warn":n=r.warn;break;default:n=r.info}"undefined"!=typeof window&&n(t)},b=e=>{if(!e)return{};const{top:t=0,bottom:n=0,right:i=0,left:s=0}=e.getBoundingClientRect&&e.getBoundingClientRect()||{};return{top:t,bottom:n,right:i,left:s,height:e.offsetHeight||e.innerHeight,width:e.offsetWidth||e.innerWidth}},f=(e,t)=>{if(!e||!t)return!1;let n=e,s=t,r=0;const o=[0,0,0,0];if((0,i.G)(e)&&(n=e.el,r=e.ratio||0),(0,i.G)(t)&&(s=t.el,t.mask&&Array.isArray(t.mask)&&t.mask.filter(((e,t)=>{o[t]=parseInt(String(e))}))),!n||!s)return!1;const{top:a=0,left:l=0,right:d=0,bottom:c=0,width:u=0,height:h=0}=b(n);if(0==u||0==h)return!1;const{top:p=0,left:g=0,width:f=0,height:m=0}=b(s),v=f+g-o[1],y=p+m-o[2],w=p+o[0],E=g+o[3];return!(a>=y-h*r||c<=w+h*r)&&!(d<=E+u*r||l>=v-u*r)},{IDKEY:m}=c;class v{constructor(e,t){a(this,"initParams"),a(this,"intersectionObFn"),a(this,"listenerEvent"),a(this,"scrollProgress",-1),a(this,"scrollCbFn",[]),a(this,"listenAddScroll",new Map),a(this,"listenMap",new Map),a(this,"scrollContainer"),"undefined"!=typeof window&&((null==t?void 0:t.fromExpose)&&g("info","scroll event from expose❗️"),this.initParams=t,this.intersectionObFn=e,this.scrollContainer=(null==t?void 0:t.scrollContainer)?h(null==t?void 0:t.scrollContainer)[0]:window,this.init())}init(){var e;this.listenerEvent=this.createListener(this.handelScrollEvent).bind(this),null==(e=this.scrollContainer)||e.addEventListener("scroll",this.listenerEvent,!1)}createListener(e,t){return void 0===e?()=>{}:t&&t>0?(0,s.n)({func:e,wait:t,options:{trailing:!1}}):e}handelScrollEvent(e){this.listenScroll(e),"function"==typeof this.intersectionObFn&&this.listenMap.size&&this.listenerEl()}listenerEl(){var e;const t=[];this.listenMap.forEach((e=>{const n=this._withInArea(e.target);e.isIntersecting!==n&&(this.listenMap.set(e.id,Object.assign(e,{isIntersecting:n})),t.push({isIntersecting:n,target:e.target}))})),t.length&&(null==(e=this.intersectionObFn)||e.call(this,t))}_withInArea(e){var t,n;return f({el:e,ratio:(null==(t=this.initParams)?void 0:t.exposeRatio)||0},{el:this.scrollContainer||window,mask:(null==(n=this.initParams)?void 0:n.mask)||[0,0,0,0]})}listenScroll(e){if(!this.scrollCbFn.length)return;const t=this.scrollContainer===window?Math.abs(b(document.body).top||0):this.scrollContainer.scrollTop||0,n=t-this.scrollProgress;if(0===n)return;const i={scrollTop:t,type:n>0?"down":"up"};this.scrollProgress=t,this.scrollCbFn.forEach((t=>t(i,e)))}listen(e,t){if("function"==typeof e){const n=p(),i=this.createListener(e,null==t?void 0:t.delay);return this.listenAddScroll.set(n,i),this.scrollCbFn.push(i),n}}unListen(e){if(e&&this.listenAddScroll.has(e)){this.listenAddScroll.delete(e);const t=[];this.listenAddScroll.forEach((e=>{t.push(e)})),this.scrollCbFn=t}}observe(e){if(!e)return;let t=e.getAttribute(m);t&&this.listenMap.has(t)||(t||(t=p(),e.setAttribute(m,t)),this.listenMap.set(t,{id:t,isIntersecting:!1,target:e}))}unobserve(e){if(!e)return;const t=e.getAttribute(m);t&&this.listenMap.delete(t)}disconnect(){var e;this.listenerEvent&&(null==(e=this.scrollContainer)||e.removeEventListener("scroll",this.listenerEvent,!1))}}class y{constructor(e,t){a(this,"evt",null),a(this,"initOption"),a(this,"handleExposeEvent",[]),a(this,"scrollContainer"),a(this,"io",null),this.initOption=e||null,"undefined"!=typeof window&&(this.scrollContainer=(null==e?void 0:e.scrollContainer)?h(null==e?void 0:e.scrollContainer)[0]:null,this.init(t))}init(e){var t,n,i,s,r;if(this.evt=((e,t)=>{if("function"==typeof window.CustomEvent)return new CustomEvent(e,t);t=t||{bubbles:!1,cancelable:!1,detail:null};const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n})("scroll",{bubbles:!1,cancelable:!1}),window.hasOwnProperty("IntersectionObserver")){const s=(null==(n=null==(t=this.initOption)?void 0:t.mask)?void 0:n.map((e=>-(parseInt(String(e))||0)+"px")).join(" "))||"0px 0px 0px 0px";this.io=new IntersectionObserver(e,{root:this.scrollContainer||null,rootMargin:s,threshold:[(null==(i=this.initOption)?void 0:i.exposeRatio)||0]}),this.scrollContainer=this.scrollContainer||window}else{const t=this.scrollContainer||window;this.scrollContainer=t,this.io=new v(e,{scrollContainer:t,exposeRatio:(null==(s=this.initOption)?void 0:s.exposeRatio)||0,mask:null==(r=this.initOption)?void 0:r.mask})}}triggerScroll(){(0,s.n)({func:()=>{var e;null==(e=this.scrollContainer)||e.dispatchEvent(this.evt)},wait:300,options:{trailing:!1}})}destroy(){var e;null==(e=this.io)||e.disconnect()}}const{IDKEY:w,REPEATKEY:E}=c;class x{constructor(e){a(this,"hasBeenExposeId",new Map),a(this,"initParams"),a(this,"scrollInstance",null),a(this,"singleBlockObMap",new Map),a(this,"intersectionIoMap",new Map),a(this,"intersectionTempExpose",new Set),a(this,"timer"),a(this,"logFn",(()=>{})),this.initParams=e,void 0!==typeof window&&this.init(e)}init(e){this.scrollInstance=new y({scrollContainer:null==e?void 0:e.scrollContainer,exposeRatio:null==e?void 0:e.exposeRatio,delay:null==e?void 0:e.delay,mask:null==e?void 0:e.mask},this.intersectionObserverCallback.bind(this)),this.logFn=(null==e?void 0:e.log)?g:()=>{}}intersectionObserverCallback(e){e.forEach((e=>{var t;const n=e.target;if(e.isIntersecting){const{delay:e=1e3}=this.initParams||{};this.intersectionTempExpose.add(n),clearTimeout(this.timer),this.timer=setTimeout((()=>{this.intersectionPreExpose([...this.intersectionTempExpose]),this.intersectionTempExpose.clear()}),e)}else(null==(t=this.initParams)?void 0:t.observeHide)&&this.sendHideEvent(n)}))}intersectionPreExpose(e){if(!e.length)return;const t={};e.forEach((e=>{if(!this._withInArea(e))return;const n=e.getAttribute(w),i=this.intersectionIoMap.get(n);i&&(t[i.code]||(t[i.code]={info:i,exposeDoms:[]}),t[i.code].exposeDoms.push(e))}));for(const e in t){const n=t[e];n.exposeDoms.length&&this.sendExposeEvent(n.info,n.exposeDoms)}}sendHideEvent(e){if(!e)return;const t=e.getAttribute(w),n=this.intersectionIoMap.get(t);if(!n)return;const{code:i,handle:s}=n;s({code:i,exposeDoms:[],hideDoms:[e]})}sendExposeEvent(e,t){const{code:n,once:i,handle:s,middleJudge:r}=e,o=t.filter((e=>{const t=this.hasBeenExposeId.get(n)||new Set,s=e.getAttribute(w)||"",o=e.getAttribute(E)||"",a=o?t.has(o):t.has(s);if(a)i&&this.removeElements([e]);else{if("function"==typeof r&&!r(e,n))return!1;i&&(t.add(s),o&&t.add(o),this.hasBeenExposeId.set(n,t),this.removeElements([e]))}return!a}));o.length&&s({code:n,hideDoms:[],exposeDoms:o})}_withInArea(e){var t,n,i;return f({el:e,ratio:(null==(t=this.initParams)?void 0:t.exposeRatio)||0},{el:null==(n=this.scrollInstance)?void 0:n.scrollContainer,mask:(null==(i=this.initParams)?void 0:i.mask)||[0,0,0,0]})}addEleObId(e){return e.filter((e=>{if(e&&1==e.nodeType){if(!e.getAttribute(w)){const t=p();e.setAttribute(w,t)}return!0}}))}singleBlock(e,t){const n=e.elements,i=(null==e?void 0:e.code)||(null==n?void 0:n.code)||`${p()}_code`,s={code:i,handle:t,once:void 0===e.once||e.once,middleJudge:null==e?void 0:e.middleJudge,elements:"",ids:new Set};let r=this.addEleObId(h(n));if(!r.length)return;const o=this.hasBeenExposeId.get(s.code);if(r=r.filter((e=>{const t=e.getAttribute(w)||"";return!(o&&o.has(t)||this.intersectionIoMap.has(t))})),!r.length)return this.logFn("warn","[basis-expose]: 未查询到元素，请检查元素是否[已曝光｜未创建]");s.elements=u(n),this.singleBlockObMap.has(i)||this.singleBlockObMap.set(i,Object.assign({},s));const a=r.map((e=>null==e?void 0:e.getAttribute(w))).filter((e=>!!e)),l=this.singleBlockObMap.get(i)||{};a.forEach((e=>{l.ids.add(e)})),this.singleBlockObMap.set(i,l),this.addToIntersectionOb(r,Object.assign({},s,{ids:null}))}multiBlock(e,t){const n=e.section;if(!n||!n.length)return this.logFn("warn","[basis-expose]: multiBlock - 请传入正确的 section 格式");n.filter((e=>!!e.target)).forEach((n=>{const{container:i,content:s,target:r,code:o}=n,a=o||`${p()}_code`,l=[i,s,r].filter((e=>!!e)).join(" ");this.singleBlock({...e,elements:{code:a,target:l}},t)}))}addToIntersectionOb(e,t){e.forEach((e=>{var n;const i=e.getAttribute(w);if(this.intersectionIoMap.has(i))return;const s=e.getAttribute(E);if(t.code&&s){const e=this.hasBeenExposeId.get(t.code);if(e&&e.has(s))return}this.intersectionIoMap.set(i,t),null==(n=this.scrollInstance)||n.io.observe(e)}))}removeElements(e){var t,n,i;if(!e||!e.length)return this.logFn("warn","[basis-expose]: removeElements - 元素应该给数组类型");for(const s of e){null==(t=this.scrollInstance)||t.io.unobserve(s);const e=s.getAttribute(w),r=this.intersectionIoMap.get(e),o=this.singleBlockObMap.get(r.code);null==(i=null==(n=null==o?void 0:o.ids)?void 0:n.delete)||i.call(n,e),this.intersectionIoMap.delete(e)}}observe(e,t){if(!e)return;const{elements:n,section:i}=e;n||i?(n&&(Array.isArray(n)?n.forEach((n=>{this.singleBlock({...e,elements:n},t)})):this.singleBlock(e,t)),i&&i.length&&this.multiBlock(e,t),this.triggerScroll()):this.logFn("info","[basis-expose]: observe - 缺少元素|选择器")}update(e){if(!e)return this.logFn("warn","[basis-expose]: update - 方法缺少code");e.split(",").forEach((e=>{const t=this.singleBlockObMap.get(e);if(t){const{handle:e}=t;this.singleBlock(t,e)}})),this.triggerScroll()}remove(e){if(!e)return this.logFn("warn","[basis-expose]: remove - 方法缺少code");e.split(",").forEach((e=>{const t=this.singleBlockObMap.get(e);if(t){const n=t.ids;(null==n?void 0:n.size)>0&&n.forEach((e=>{this.intersectionIoMap.delete(e)})),this.singleBlockObMap.delete(e)}this.hasBeenExposeId.delete(e)}))}reset(e){if(!e)return this.logFn("warn","[basis-expose]: reset - 方法缺少code");const t=this.hasBeenExposeId.get(e);t&&(this.hasBeenExposeId.delete(e),[...t].forEach((t=>{const n=h(`[${w}="${t}"]`);if(!n)return;const i=this.singleBlockObMap.get(e);i&&this.singleBlock({...i,elements:{code:e,target:n}},i.handle)})),this.triggerScroll())}resetAll(e){var t;if(this.hasBeenExposeId.size>0){let n=[...this.hasBeenExposeId];e&&("function"==typeof e&&(n=e(n)),"string"==typeof e&&(n=null==(t=null==n?void 0:n.filter)?void 0:t.call(n,(t=>!!t.length&&t[0].startsWith(e))))),n.map((e=>e[0])).forEach((e=>{this.reset(e)}))}}destroy(){var e;null==(e=this.scrollInstance)||e.destroy();const t=l(this.initParams||{});t&&d.del(t)}triggerScroll(){var e;null==(e=this.scrollInstance)||e.triggerScroll()}}var I=n(274061),C=n(665640);const _=new Map,A={get(e){return _.get(e)},has(e){return _.has(e)},set(e,t){return _.set(e,t),_},delete(e){_.delete(e)}},M=function(e){return e&&/^[12](-\d+){2,4}$/.test(e)},S=function(e){if(!e||M(e))return e;if(e.indexOf("：")>=0)throw new Error("please use english colon.");let[t,n]=e.split(/:/),[i,s,r]=t.split(".");return n=n||"",{evName:i?i.trim():"",pageName:(s||"common").trim(),eId:(r||"").trim(),evSegment:[i,s,r].filter((e=>e&&e.trim())).join("."),modifiers:n.split(".").filter((e=>e&&e.trim()))}};function D(e=0){const t=this;return function(n,...i){const s=()=>{if(!n||"function"!=typeof n)return;n.bind(t,...i)()};e?setTimeout(s,e):s()}}function O(){return Number(Math.random().toString().slice(3,6)+Date.now()).toString(36)}function T(e,t){return"undefined"==typeof window?{}:3==+t?e:{inserted:e.mounted,componentUpdated:e.updated,unbind:e.unmounted}}class k{constructor(){this.subscriber={},this.unSendEvent={},this.has=Object.prototype.hasOwnProperty}publish({target:e=null,daId:t=null,bindData:n=null,sendType:i="event",extraData:s={},parsed:r={}}={}){t&&(this.has.call(this.subscriber,t)?M(t)?this.subscriber[t].sendType.includes(i)&&this.subscriber[t].handler({target:e,extraData:s,bindData:n}):this.subscriber[t]&&this.subscriber[t]({target:e,extraData:s,bindData:n,parsed:r}):this.pushEventInQueue({target:e,daId:t,sendType:i,extraData:s,bindData:n}))}subscribe({daId:e=null,handler:t=null,sendType:n=!1}={}){if(e&&t&&!this.has.call(this.subscriber,e)){if(M(e))return this.subscriber[e]={sendType:n,handler:t},void this.executeEventInQueue({daId:e,handler:t,sendType:n});this.subscriber[e]=t,this.executeEventInQueue({daId:e,handler:t})}}unsubscribe(e){e.forEach((e=>{this.subscriber.hasOwnProperty(e)&&delete this.subscriber[e]}))}pushEventInQueue({target:e=null,daId:t=null,sendType:n="event",bindData:i=null,extraData:s={}}={}){this.has.call(this.unSendEvent,t)||(this.unSendEvent[t]=[]),this.unSendEvent[t].push({target:e,daId:t,sendType:n,bindData:i,extraData:s})}executeEventInQueue({daId:e=null,handler:t=null,sendType:n=[]}={}){if(!this.has.call(this.unSendEvent,e)||this.unSendEvent[e].length<=0)return;let i=this.unSendEvent[e].length;for(;i>0;){let s=this.unSendEvent[e].shift();n.includes(s.sendType)&&t&&t({target:s.target,extraData:s.extraData,bindData:s.bindData}),--i}}}class P{constructor({controlCenter:e=null}={}){this.controlCenter=e}notify({target:e=null,daId:t=null,sendType:n="event",bindData:i=null,extraData:s={},parsed:r={}}={}){t&&this.controlCenter.publish({target:e,daId:t,sendType:n,extraData:s,bindData:i,parsed:r})}}const B=(e,t)=>e?t.reduce(((t,n)=>(Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]),t)),{}):{},$=(e,t)=>e?t&&0!==t.length?t.reduce(((e,t)=>(delete e[t],e)),{...e}):e:{},N="undefined"!=typeof window?window:{};N.G_SA_TRACK=N.G_SA_TRACK||{};const L=()=>{};let j={v2:L,getMapping:null,legacyAbcd:{addSubscriber:L,triggerNotice:L,getExposeInstance:L,importAbcdCode:L}};function R(e){if("undefined"!=typeof window)return N.G_SA_TRACK.__asyncImports?(C.warn("value has been assigned."),!1):(j=N.G_SA_TRACK.__asyncImports=e,!0)}const F=new Proxy({},{get:(e,t)=>{const n=N.G_SA_TRACK.__asyncImports;return j.hasOwnProperty(t)?n[t]||j[t]:null}});let V=!1;const H={pc:"she_dist",h5:"sh5_dist",pwa:"pwa_dist"};if("undefined"!=typeof window&&"undefined"!=typeof gbCommonInfo){const{PUBLIC_CDN:e="",PLATFORM:t="PC"}=gbCommonInfo;window.__webpack_public_path__=`${e}/${H[t.toLowerCase()]}/assets/`}"undefined"!=typeof window&&(V=!0);const Q=async e=>{if(!e||"string"!=typeof e)return Promise.resolve();let t=e.split("-")||[],n=[];try{let e=t[0]||"0";if(!aTagMap[e])throw new Error(`aTag: ${e} undefined from aTagMap: ${JSON.stringify(aTagMap)}`);n.push(aTagMap[e]);let i=t[1]||"0";if(!bTagMap[`${e}-${i}`])throw new Error(`bTag: ${e}-${i} undefined from bTagMap: ${JSON.stringify(bTagMap)}`);if(n.push(bTagMap[`${e}-${i}`]),"1"===e){let s=t[2]||"0";if(!cTagMap[`${e}-${i}-${s}`])throw new Error(`cTag: ${e}-${i}-${s} undefined from cTabMap: ${JSON.stringify(cTagMap)}`);n.push(cTagMap[`${e}-${i}-${s}`])}return F.legacyAbcd.importAbcdCode(`${n.join("/")}`)}catch(e){return C.error(e),Promise.resolve()}},J=Object.create(null);let K=null;let W={subscribeLoadQueue:[],executeSubscribeRequireInQueue(){for(;this.subscribeLoadQueue.length>0;){let{resolve:e,modulecode:t}=this.subscribeLoadQueue.shift();e(Q({modulecode:t}))}},require({modCode:e}={}){return e?V?M(e)?Q(e):/^(page_|comp_|common)/.test(e)?(async(e,t)=>{K||(K=F.getMapping());try{const n=K[e||"common"];if(t){const e=n[t];return F.v2(e)}if(J[e]||!n)return{default:null};const i=[...new Set(Object.values(n))],s=(await Promise.allSettled(i.map((async e=>{try{return(await F.v2(e)).default}catch(e){return C.error(e),{default:null}}})))).reduce(((e,t)=>"fulfilled"===t.status?{...e,...t.value}:e),{});return J[e]=s,{default:s}}catch(e){return C.error(e),{default:null}}})(e):Promise.resolve():new Promise(((t,n)=>{this.subscribeLoadQueue.push({resolve:t,reject:n,modCode:e})})):Promise.resolve()}};let G="error";const z={all:0,debug:10,info:20,warning:30,error:40,off:50},q=new Proxy(C,{get(e,t,n){if("setLevel"===t)return e=>{G=e};if(!Reflect.has(e,t))return()=>{};const i=Reflect.get(e,t,n);return(...n)=>{if(!(z[t]<z[G]))return i.apply(e,["[sa-event-center]",...n,"at",Date.now().toString()])}}});q.setLevel("info");var Y={report({sa:e=null}={}){e&&this._sendSa(e)},_sendSa({name:e=null,param:t=null,beacon:n=null,image:i=null,page_param:s=null,page_name:r=null,page_id:o=null}={}){if(!e)return;if("undefined"==typeof sa)return void C.error(`shein-sa is not exist when sending ${[e,JSON.stringify(t)]}`);const a={};r&&(a.page_name=r),o&&(a.page_id=o),q.debug(e,"start report data"),sa("send",{...a,activity_name:e,activity_param:t||{}},{beacon:n?1:0,image:i?1:0})}};class U{constructor({controlCenter:e=null}={}){this.controlCenter=e,this.analysis=W,this.loadedPageNames={}}subscribe({modCode:e=null}={}){return/^(page_|comp_|common)/.test(e=e||"common")&&this.loadedPageNames[e]?Promise.resolve({}):this.analysis.require({modCode:e}).then((({default:t}={})=>{if(!t)return{};if(/^(page_|comp_|common)/.test(e)){if(this.loadedPageNames[e])return;this.loadedPageNames[e]=t}return Object.entries(t).forEach((e=>{const n=e[0];M(n)?this._orgNumMapSub(e[0],e[1],t):this.subNewDirectMap(e[0],e[1])})),t}))}_orgNumMapSub(e,t,n){let{sa:i,ga:s,sendType:r,handler:o}=t;const a=i?JSON.parse(JSON.stringify(i)):void 0,l=s?JSON.parse(JSON.stringify(s)):void 0,d=o?o.bind(n,{sa:a,ga:l,report:Y.report.bind(Y)}):Y.report.bind(Y,{sa:a,ga:l});this.controlCenter.subscribe({daId:e,handler:d,sendType:r})}_getMergeParamObj({target:e,extraData:t={},bindData:n={}},i){const s=/^expose_/.test(i.evName)&&i.modifiers.includes("list"),r=(Array.isArray(e)?e:e?[e]:[]).map((e=>e.dataset||null));return{mergeParams:{..."[object Object]"===Object.prototype.toString.call(n)?n:Array.isArray(n)?s?{bindData:n}:n[0]:n,...t},source:{extraData:t,bindData:n,dataset:s?r:r[0]}}}subNewDirectMap(e,t){t=t||(e=>e.extraData);this.controlCenter.subscribe({daId:e,handler:async({target:e,extraData:n,bindData:i,parsed:s})=>{const r=e=>{r._called=!0,Y.report({sa:e})},o=this._getMergeParamObj({target:e,extraData:n,bindData:i},s);let a=t({extraData:o.mergeParams,source:o.source,target:e,name:s.evName,parsed:s,report:r},{pick:B,omit:$,select(e){return B(1===arguments.length?n:arguments[1],e)}})||Object.create(null);for(;a&&"function"==typeof a.then;)a=await a;const l=Object.prototype.toString.call(a).slice(8,-1);return!!r._called||(r._called||["Object","Null"].includes(l)?void this.reportWithParams(s.evName,a||{}):(C.error(`The return value of track function is ${l}, should be an object.`),!1))}})}directlyReport(e,t){const n=S(e),i=this._getMergeParamObj(t,n);this.reportWithParams(n.evName,i.mergeParams)}reportWithParams(e,t){const n="sa_v2",i="page_name",s="page_id",r="send_beacon",o="send_img";let a=e;const l={};let d=(null==t?void 0:t.$options)||{};t&&Object.keys(t).forEach((e=>{e.startsWith("$")&&delete t[e]})),d[n]&&(a=e+"_sem"),d[s]&&(l.page_id=d[s]),d[i]&&(l.page_name=d[i]),Object.keys(l).length&&window.sa("set","setPageData",{...window.SaPageInfo,...l}),Y.report({sa:{name:a,param:t||{},...l,image:!!d[o],beacon:!!d[r]}})}}class X{constructor({controlCenter:e=null,publisher:t=null,subscriber:n=null}){this.controlCenter=e,this.publisher=t,this.subscriber=n,this.eventAttributeMap={click:"da-event-click",touchstart:"da-event-touchstart",focus:"da-event-focus",blur:"da-event-blur"},this._bindEvent({event:"click",attribute:this.eventAttributeMap.click}),this._bindEvent({event:"touchstart",attribute:this.eventAttributeMap.touchstart}),this._bindEvent({event:"focus",attribute:this.eventAttributeMap.focus,useCapture:!0}),this._bindEvent({event:"blur",attribute:this.eventAttributeMap.blur,useCapture:!0})}_bindEvent({event:e="",attribute:t="",useCapture:n=!1}={}){"undefined"!=typeof document&&document&&document.addEventListener(e,(e=>{var n;if(!t||document===e.target)return;const i=null==(n=e.target)?void 0:n.closest(`[${t}]`);if(!i)return;let s=i.getAttribute(t);this.publisher.notify({daId:s,sendType:"event",target:i})}),n)}bindEventByDaId({event:e="",daId:t=""}={}){document.querySelectorAll(`[${this.eventAttributeMap[e]}="${t}"]`).forEach((n=>{n.addEventListener(e,(e=>{this.publisher.notify({daId:t,sendType:"event",target:e.currentTarget})}))}))}}const Z=new Map,ee=({code:e})=>{const t=location.pathname;if(Z.has(t)){Z.get(t).add(e)}else Z.set(t,new Set([e]));return Z};class te{constructor({publisher:e,context:t,...n}){this.exposeInst=new x(n),this.publisher=e,this.context=t,this.pendingQueue=[],this.isConsumingPending=!1,this.domInfo={loaded:"loading"!==document.readyState},window.addEventListener("DOMContentLoaded",(()=>{this.domInfo.loaded=!0,this.consumePending()}))}async subscribe({keycode:e="",type:t="",horizontal:n=!1,once:i=!0,middleJudge:s=null,hooks:r={}}){const o=e.split(",");if(!o.length)return;if(!this.checkDocLoad("subscribe",arguments))return;let a=[],l=[];o.forEach((e=>{const i=e.split("`");if(!i[0])return C.warn(`da expose: [${e}] missing subscribe code`);if(i.length<=1)return C.warn(`da expose: subscriber code [${i[0]}] missing expose id`);const s=i[1].split("|").map((e=>`[da-event-expose='${e}']`));"PWA"===gbCommonInfo.PLATFORM&&ee({code:i[0]}),"list"===t?a.push({code:i[0],container:`[da-expose-code=${i[0]}]`,target:s.join(),averageContent:!1,horizontal:n}):l.push({code:i[0],target:s.map((e=>`[da-expose-code=${i[0]}] ${e}`)).join()})})),(a.length||l.length)&&this.exposeInst.observe({section:a,elements:l,middleJudge:s,once:i},(({exposeDoms:e})=>{let t={};e.forEach((e=>{if(!e)return;const n=e.getAttribute("da-event-expose");let i=t[n]||[];i.push(e),t[n]=i}));for(const e in t){const n=t[e];(null==r?void 0:r.afterExpose)&&"function"==typeof r.afterExpose&&r.afterExpose({targets:n,daId:e}),this.context.triggerNotice({daId:e,sendType:"event",target:n})}}))}async directiveSubscribe(e,t,n){const{getBindInfo:i,getDoubleBindInfo:s}=n;this.checkDocLoad("directiveSubscribe",arguments)&&this.exposeInst.observe(t,(({exposeDoms:t})=>{let r={};t.forEach((t=>{var n;if(!t)return;let s=r[e]||{doms:[],binding:[]};s.doms.push(t),s.binding.push((null==(n=i(t))?void 0:n.data)||null),r[e]=s}));for(const e in r){const t=r[e];(null==n?void 0:n.afterExpose)&&"function"==typeof n.afterExpose&&n.afterExpose({targets:t.doms,daId:e}),this.context.triggerNotice({daId:e,sendType:"event",target:t.doms,bindData:t.binding})}const o=new Set(t.map(s).filter(Boolean).map((e=>e.id)));if(0===o.length)return;if(t.length>1&&o.size>1)throw new Error("id of attribute data-v2-expose is not same in list elements.");const a={id:[...o][0],domList:t,binding:t.map(s).filter(Boolean).map((e=>e.data||null))};this.context.triggerNotice({daId:a.id,sendType:"event",target:a.domList,bindData:a.binding})}))}reset(e){this.exposeInst.reset(e)}resetAll(e){this.exposeInst.resetAll(e)}triggerScroll(){this.exposeInst.triggerScroll()}update(e){this.exposeInst.update(e)}destroy(){var e;null==(e=this.exposeInst)||e.destroy()}remove(e){var t;null==(t=this.exposeInst)||t.remove(e)}checkDocLoad(e,t){return this.domInfo.loaded?(this.domInfo.loaded&&0===this.pendingQueue.length||this.consumePending(),!0):(this.pendingQueue.push([e,t]),!1)}consumePending(){if(this.isConsumingPending)return!0;this.isConsumingPending=!0,this.pendingQueue.length>0&&(this.pendingQueue.forEach((([e,t])=>{this[e]&&this[e].apply(this,t)})),this.pendingQueue=[])}}const ne=(e=>{const t=l(e||{});if(t){const e=d.get(t);if(e)return e}const n=new x(e);return t&&d.set(Object.assign(t,{instance:n})),n})();let ie=null;"undefined"!=typeof window&&(window.windowScrollInstance=ne,ie=new v);class se{constructor(e=""){let t=null;C.info("%c[sa-event-center] version: 0.1.1","color:green;font-size:14px;font-weight:bold;"),t="string"==typeof e?{mode:"runtime"===e?"runtime":"initial"}:e||{mode:"runtime"},this.options=t,this.controlCenter=new k,this.publisher=new P({controlCenter:this.controlCenter}),this.subscriber=new U({controlCenter:this.controlCenter}),this.event=new X({controlCenter:this.controlCenter,publisher:this.publisher,subscriber:this.subscriber}),this.scrollInstance=this.getExposeInstance()}addSubscriber(e){const t=[];if("string"==typeof e)t.push(e);else if(Array.isArray(e))t.push(...e);else if("object"==typeof e){const n=e.modCode||e.modulecode;n&&t.push(n)}const n=t.filter(Boolean).map((e=>M(e)?F.legacyAbcd?F.legacyAbcd.addSubscriber({modulecode:e}):null:this.subscriber.subscribe({modCode:e})));return Promise.allSettled(n).then((e=>!0))}addSubscriberObject(e){const t=Object.keys(e),n=[];for(let s of t){const t=e[s];t&&"function"==typeof t?(i=s)&&/^[a-z_]+(?:\.(page_|comp_)[\w-]+(?:\.[\w-]+)?)?$/.test(i)?(n.push(s),this.subscriber.subNewDirectMap(s,t)):q.warn("only support v2 event, as-like event_name.page_name:modifiers ."):q.warn(`invalid ${s} or handler.`)}var i;return()=>new Promise((e=>{setTimeout((()=>{this.controlCenter.unsubscribe(n),e()}),0)}))}async triggerNotice({target:e,daIdTag:t="",daId:n="",id:i,sendType:s="user",bindData:r=null,extraData:o=null,data:a=null}={},l=0){if(o=o||a||{},!(n=n||i||""))return;const d=Array.prototype.slice.call(arguments);d[0].daId=d[0].id=n,d[0].extraData=d[0].data=o,q.debug(n,"trigger event");const c=D.call(this,l);if(t&&!e){const i=document.querySelectorAll(`[${t}="${n}"]`);e=i&&i.length>0&&i[0]}if(M(n))return d[0].from_v2_proxy=!0,F.legacyAbcd.triggerNotice(...d),!0;let u=S(n);const{evName:h,pageName:p,eId:g,modifiers:b,evSegment:f}=u;if(!h)throw new Error("event name should be not empty");if(b.includes("simple"))return this.subscriber.directlyReport(n,{target:e,extraData:o,bindData:r}),!0;const m="runtime"===this.options.mode;m&&!this.subscriber.loadedPageNames[p]&&"function"==typeof F.getMapping&&(q.debug(n,"pull config begin"),await this.addSubscriber({modCode:p}),q.debug(n,"pull config end"));if(!g&&!this.controlCenter.subscriber[f]&&!this.controlCenter.subscriber[h])return m&&C.warn(`${n} does not exist in ${F.getMapping?"mapping file":"subscriber"} or you should use "simple" modifier.`),!1;c(this.publisher.notify,{target:e,daId:n.split(":")[0],parsed:u,sendType:s,extraData:o,bindData:r})}reportHandler({sa:e=null,sensors:t=null}={}){Y.report({sa:e,sensors:t})}bindEvent({event:e="",daId:t=""}={}){e&&t&&this.event.bindEventByDaId({event:e,daId:t})}getExposeInstance(e){return!e&&this.scrollInstance?this.scrollInstance:new te({publisher:this.publisher,...e,context:this})}}const re="undefined"==typeof window?{addSubscriber(){},triggerNotice(){},reportHandler(){},bindEvent(){},getExposeInstance(){}}:window.daEventCenterV2?window.daEventCenterV2:window.daEventCenterV2=new se("runtime"),oe=e=>{const t=e.value;return!t||!t.id},ae=e=>({set(t,n){return t[e]=n,n},get(t){return t[e]},updateBindValue(e,t){const n=this.get(e);return n?A.set(n,t.value):null},getBindValue(e){return this.get(e)?A.get(this.get(e)):null},clear(t){const n=this.get(t);if(!n)return null;setTimeout((()=>{A.delete(n),delete t[e]}),"PWA"!==("undefined"==typeof window?"":(window.gbCommonInfo||{PLATFORM:""}).PLATFORM||"")?0:1100)}});const{tap:le,expose:de,tapDouble:ce,exposeDouble:ue}=function(e,t){const n="function"==typeof t?t():t||null,{vueVersion:i}={vueVersion:3,...n},s=O(),r=e=>`${e}_${s}`,o=ae(r("__binding_tap")),a=ae(r("__binding_tap_double")),l=ae(r("__binding_ep")),d=ae(r("__binding_ep_double"));return{tap:T({async mounted(t,n){if(oe(n))return!1;const i=O();A.set(o.set(t,i),n.value),t.addEventListener("click",(()=>{const{id:n,data:i}=o.getBindValue(t);(M(n)?F.legacyAbcd.triggerNotice:e.triggerNotice.bind(e))({daId:n,target:t,bindData:i});const s=a.getBindValue(t);if(!s||!s.id)return;(M(s.id)?F.legacyAbcd.triggerNotice:e.triggerNotice.bind(e))({daId:s.id,target:t,bindData:s.data})}))},updated:o.updateBindValue.bind(o),unmounted:o.clear.bind(o)},i),expose:T({async mounted(t,n){if(oe(n))return!1;const i=O();A.set(l.set(t,i),n.value);const{id:s,container:r}=n.value;let o=n.value.code||i,a=void 0===n.value.once||n.value.once;n.value.prefix&&(o=`${n.value.prefix}_${o||O()}`),await(0,I.nextTick)(),ee({code:o});const c=d.getBindValue(t);c&&ee({code:c.code||d.get(t)});const u="number"==typeof n.value.delay&&0==+n.value.delay?e.getExposeInstance({delay:0}):e.getExposeInstance(),h=()=>{u.directiveSubscribe(s,{elements:{code:o,container:r,target:t},once:a},{getBindInfo:l.getBindValue.bind(l),getDoubleBindInfo:d.getBindValue.bind(d),afterExpose:n.value.callback||null})};if(n.value.waitReady&&"true"!==t.dataset.ready){let e=null;const n=n=>{for(const i of n)"attributes"===i.type&&"data-ready"===i.attributeName&&"true"===t.dataset.ready&&(h(),e.disconnect(),e=null)};e=new MutationObserver(n),e.observe(t,{attributes:!0})}else n.value.delayReady>0?setTimeout(h,n.value.delayReady):h()},updated:l.updateBindValue.bind(l),unmounted:l.clear.bind(l)},i),tapDouble:T({mounted(e,t){if(oe(t))return!1;const n=O();A.set(a.set(e,n),t.value)},updated:a.updateBindValue.bind(a),unmounted:a.clear.bind(a)},i),exposeDouble:T({mounted(e,t){if(oe(t))return!1;const n=O();A.set(d.set(e,n),t.value)},updated:d.updateBindValue.bind(d),unmounted:d.clear.bind(d)},i)}}(re,(()=>{var e;let t="3";if("undefined"==typeof window)return{};const n=window.gbCommonInfo||{PLATFORM:""};return window.Vue?t=window.Vue.version:n&&n.PLATFORM&&(t=["PWA","H5"].includes(n.PLATFORM)?"2":"3"),t=+((null==(e=t.match(/\d+/))?void 0:e[0])||"3"),{vueVersion:+t}}));function he(e){e.directive("tap",le),e.directive("expose",de),e.directive("tap-double",ce),e.directive("expose-double",ue)}}}]);
//# sourceMappingURL=70827-470aaf03eb46d27e.js.map