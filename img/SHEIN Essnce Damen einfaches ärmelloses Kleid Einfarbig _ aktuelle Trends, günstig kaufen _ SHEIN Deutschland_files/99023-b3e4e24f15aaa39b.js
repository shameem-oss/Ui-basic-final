"use strict";(self.webpackChunkSHEIN_W=self.webpackChunkSHEIN_W||[]).push([[99023],{199023:function(e,t,n){n.d(t,{It:function(){return k},OY:function(){return m},v3:function(){return I}});var i=n(659015),s=n(14900),o=n(665640),r=Object.defineProperty,l=(e,t,n)=>(((e,t,n)=>{t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);const c=e=>{var t;if("undefined"==typeof window)return null;return{container:e.scrollContainer?e.scrollContainer instanceof HTMLElement?e.scrollContainer:document.querySelector(e.scrollContainer):window,key:[null==(t=e.mask)?void 0:t.map((e=>parseFloat(String(e)))).join(""),e.delay,e.exposeRatio,e.observeHide?"obHide":""].join("")}},a={cache:new Map,get(e){const t=(this.cache.get(e.container)||[]).find((t=>t.key==e.key));return t?t.instance:null},set(e){const t=this.cache.get(e.container)||[];t.find((t=>t.key==e.key))||(t.push({key:e.key,instance:e.instance}),this.cache.set(e.container,t))},del(e){if(e.key){const t=this.cache.get(e.container)||[],n=t.findIndex((t=>t.key==e.key));t.splice(n,1),t.length?this.cache.set(e.container,t):this.cache.delete(e.container)}else this.cache.delete(e.container)}},h={IDKEY:"da-eid",REPEATKEY:"da-rid"},d=e=>{if("undefined"==typeof window||!e)return"";if("string"==typeof e)return e;if(e instanceof HTMLElement){const t=e.getAttribute(h.IDKEY);return`[${h.IDKEY}=${t}]`}if((0,i.G)(e))return e.target instanceof HTMLElement?{code:(null==e?void 0:e.code)||"",target:d(e.target)}:e;if(e.length){const t=e[0].classList;return Array.prototype.map.call(t,(e=>`.${e}`)).join("")}return""},u=e=>"undefined"!=typeof window&&e?e instanceof HTMLElement?[e]:"string"==typeof e?Array.prototype.slice.call(document.querySelectorAll(e)):(0,i.G)(e)?u(e.target):e.length?Array.prototype.slice.call(e):[e]:[],p=()=>Number(Math.random().toString().substr(3,3)+Date.now()).toString(36),g=(e,t)=>{let n;switch(e){case"error":n=o.error;break;case"warn":n=o.warn;break;default:n=o.info}"undefined"!=typeof window&&n(t)},f=e=>{if(!e)return{};const{top:t=0,bottom:n=0,right:i=0,left:s=0}=e.getBoundingClientRect&&e.getBoundingClientRect()||{};return{top:t,bottom:n,right:i,left:s,height:e.offsetHeight||e.innerHeight,width:e.offsetWidth||e.innerWidth}},v=(e,t)=>{if(!e||!t)return!1;let n=e,s=t,o=0;const r=[0,0,0,0];if((0,i.G)(e)&&(n=e.el,o=e.ratio||0),(0,i.G)(t)&&(s=t.el,t.mask&&Array.isArray(t.mask)&&t.mask.filter(((e,t)=>{r[t]=parseInt(String(e))}))),!n||!s)return!1;const{top:l=0,left:c=0,right:a=0,bottom:h=0,width:d=0,height:u=0}=f(n);if(0==d||0==u)return!1;const{top:p=0,left:g=0,width:v=0,height:b=0}=f(s),m=v+g-r[1],E=p+b-r[2],w=p+r[0],y=g+r[3];return!(l>=E-u*o||h<=w+u*o)&&!(a<=y+d*o||c>=m-d*o)},{IDKEY:b}=h;class m{constructor(e,t){l(this,"initParams"),l(this,"intersectionObFn"),l(this,"listenerEvent"),l(this,"scrollProgress",-1),l(this,"scrollCbFn",[]),l(this,"listenAddScroll",new Map),l(this,"listenMap",new Map),l(this,"scrollContainer"),"undefined"!=typeof window&&((null==t?void 0:t.fromExpose)&&g("info","scroll event from expose❗️"),this.initParams=t,this.intersectionObFn=e,this.scrollContainer=(null==t?void 0:t.scrollContainer)?u(null==t?void 0:t.scrollContainer)[0]:window,this.init())}init(){var e;this.listenerEvent=this.createListener(this.handelScrollEvent),null==(e=this.scrollContainer)||e.addEventListener("scroll",this.listenerEvent.bind(this),!1)}createListener(e,t){return void 0===e?()=>{}:t&&t>0?(0,s.n)({func:e,wait:t,options:{trailing:!1}}):e}handelScrollEvent(e){this.listenScroll(e),"function"==typeof this.intersectionObFn&&this.listenMap.size&&this.listenerEl()}listenerEl(){var e;const t=[];this.listenMap.forEach((e=>{const n=this._withInArea(e.target);e.isIntersecting!==n&&(this.listenMap.set(e.id,Object.assign(e,{isIntersecting:n})),t.push({isIntersecting:n,target:e.target}))})),t.length&&(null==(e=this.intersectionObFn)||e.call(this,t))}_withInArea(e){var t,n;return v({el:e,ratio:(null==(t=this.initParams)?void 0:t.exposeRatio)||0},{el:this.scrollContainer||window,mask:(null==(n=this.initParams)?void 0:n.mask)||[0,0,0,0]})}listenScroll(e){if(!this.scrollCbFn.length)return;const t=this.scrollContainer===window?Math.abs(f(document.body).top||0):this.scrollContainer.scrollTop||0,n=t-this.scrollProgress;if(0===n)return;const i={scrollTop:t,type:n>0?"down":"up"};this.scrollProgress=t,this.scrollCbFn.forEach((t=>t(i,e)))}listen(e,t){if("function"==typeof e){const n=p(),i=this.createListener(e,null==t?void 0:t.delay);return this.listenAddScroll.set(n,i),this.scrollCbFn.push(i),n}}unListen(e){if(e&&this.listenAddScroll.has(e)){this.listenAddScroll.delete(e);const t=[];this.listenAddScroll.forEach((e=>{t.push(e)})),this.scrollCbFn=t}}observe(e){if(!e)return;let t=e.getAttribute(b);t&&this.listenMap.has(t)||(t||(t=p(),e.setAttribute(b,t)),this.listenMap.set(t,{id:t,isIntersecting:!1,target:e}))}unobserve(e){if(!e)return;const t=e.getAttribute(b);t&&this.listenMap.delete(t)}disconnect(){this.listenerEvent&&window.removeEventListener("scroll",this.listenerEvent,!1)}}class E{constructor(e,t){l(this,"evt",null),l(this,"initOption"),l(this,"handleExposeEvent",[]),l(this,"scrollContainer"),l(this,"io",null),this.initOption=e||null,"undefined"!=typeof window&&(this.scrollContainer=(null==e?void 0:e.scrollContainer)?u(null==e?void 0:e.scrollContainer)[0]:null,this.init(t))}init(e){var t,n,i,s,o;if(this.evt=((e,t)=>{if("function"==typeof window.CustomEvent)return new CustomEvent(e,t);t=t||{bubbles:!1,cancelable:!1,detail:null};const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n})("scroll",{bubbles:!1,cancelable:!1}),window.hasOwnProperty("IntersectionObserver")){const s=(null==(n=null==(t=this.initOption)?void 0:t.mask)?void 0:n.map((e=>-(parseInt(String(e))||0)+"px")).join(" "))||"0px 0px 0px 0px";this.io=new IntersectionObserver(e,{root:this.scrollContainer||null,rootMargin:s,threshold:[(null==(i=this.initOption)?void 0:i.exposeRatio)||0]}),this.scrollContainer=this.scrollContainer||window}else{const t=this.scrollContainer||window;this.scrollContainer=t,this.io=new m(e,{scrollContainer:t,exposeRatio:(null==(s=this.initOption)?void 0:s.exposeRatio)||0,mask:null==(o=this.initOption)?void 0:o.mask})}}triggerScroll(){(0,s.n)({func:()=>{var e;null==(e=this.scrollContainer)||e.dispatchEvent(this.evt)},wait:300,options:{trailing:!1}})}destroy(){var e;null==(e=this.io)||e.disconnect()}}const{IDKEY:w,REPEATKEY:y}=h;class I{constructor(e){l(this,"hasBeenExposeId",new Map),l(this,"initParams"),l(this,"scrollInstance",null),l(this,"singleBlockObMap",new Map),l(this,"intersectionIoMap",new Map),l(this,"intersectionTempExpose",new Set),l(this,"timer"),l(this,"logFn",(()=>{})),this.initParams=e,void 0!==typeof window&&this.init(e)}init(e){this.scrollInstance=new E({scrollContainer:null==e?void 0:e.scrollContainer,exposeRatio:null==e?void 0:e.exposeRatio,delay:null==e?void 0:e.delay,mask:null==e?void 0:e.mask},this.intersectionObserverCallback.bind(this)),this.logFn=(null==e?void 0:e.log)?g:()=>{}}intersectionObserverCallback(e){e.forEach((e=>{var t;const n=e.target;if(e.isIntersecting){const{delay:e=1e3}=this.initParams||{};this.intersectionTempExpose.add(n),clearTimeout(this.timer),this.timer=setTimeout((()=>{this.intersectionPreExpose([...this.intersectionTempExpose]),this.intersectionTempExpose.clear()}),e)}else(null==(t=this.initParams)?void 0:t.observeHide)&&this.sendHideEvent(n)}))}intersectionPreExpose(e){if(!e.length)return;const t={};e.forEach((e=>{if(!this._withInArea(e))return;const n=e.getAttribute(w),i=this.intersectionIoMap.get(n);i&&(t[i.code]||(t[i.code]={info:i,exposeDoms:[]}),t[i.code].exposeDoms.push(e))}));for(const e in t){const n=t[e];n.exposeDoms.length&&this.sendExposeEvent(n.info,n.exposeDoms)}}sendHideEvent(e){if(!e)return;const t=e.getAttribute(w),n=this.intersectionIoMap.get(t);if(!n)return;const{code:i,handle:s}=n;s({code:i,exposeDoms:[],hideDoms:[e]})}sendExposeEvent(e,t){const{code:n,once:i,handle:s,middleJudge:o}=e,r=t.filter((e=>{const t=this.hasBeenExposeId.get(n)||new Set,s=e.getAttribute(w)||"",r=e.getAttribute(y)||"",l=r?t.has(r):t.has(s);if(l)i&&this.removeElements([e]);else{if("function"==typeof o&&!o(e,n))return!1;i&&(t.add(s),r&&t.add(r),this.hasBeenExposeId.set(n,t),this.removeElements([e]))}return!l}));r.length&&s({code:n,hideDoms:[],exposeDoms:r})}_withInArea(e){var t,n,i;return v({el:e,ratio:(null==(t=this.initParams)?void 0:t.exposeRatio)||0},{el:null==(n=this.scrollInstance)?void 0:n.scrollContainer,mask:(null==(i=this.initParams)?void 0:i.mask)||[0,0,0,0]})}addEleObId(e){return e.filter((e=>{if(e&&1==e.nodeType){if(!e.getAttribute(w)){const t=p();e.setAttribute(w,t)}return!0}}))}singleBlock(e,t){const n=e.elements,i=(null==e?void 0:e.code)||(null==n?void 0:n.code)||`${p()}_code`,s={code:i,handle:t,once:void 0===e.once||e.once,middleJudge:null==e?void 0:e.middleJudge,elements:"",ids:new Set};let o=this.addEleObId(u(n));if(!o.length)return;const r=this.hasBeenExposeId.get(s.code);if(o=o.filter((e=>{const t=e.getAttribute(w)||"";return!(r&&r.has(t)||this.intersectionIoMap.has(t))})),!o.length)return this.logFn("warn","[basis-expose]: 未查询到元素，请检查元素是否[已曝光｜未创建]");s.elements=d(n),this.singleBlockObMap.has(i)||this.singleBlockObMap.set(i,Object.assign({},s));const l=o.map((e=>null==e?void 0:e.getAttribute(w))).filter((e=>!!e)),c=this.singleBlockObMap.get(i)||{};l.forEach((e=>{c.ids.add(e)})),this.singleBlockObMap.set(i,c),this.addToIntersectionOb(o,Object.assign({},s,{ids:null}))}multiBlock(e,t){const n=e.section;if(!n||!n.length)return this.logFn("warn","[basis-expose]: multiBlock - 请传入正确的 section 格式");n.filter((e=>!!e.target)).forEach((n=>{const{container:i,content:s,target:o,code:r}=n,l=r||`${p()}_code`,c=[i,s,o].filter((e=>!!e)).join(" ");this.singleBlock({...e,elements:{code:l,target:c}},t)}))}addToIntersectionOb(e,t){e.forEach((e=>{var n;const i=e.getAttribute(w);if(this.intersectionIoMap.has(i))return;const s=e.getAttribute(y);if(t.code&&s){const e=this.hasBeenExposeId.get(t.code);if(e&&e.has(s))return}this.intersectionIoMap.set(i,t),null==(n=this.scrollInstance)||n.io.observe(e)}))}removeElements(e){var t,n,i;if(!e||!e.length)return this.logFn("warn","[basis-expose]: removeElements - 元素应该给数组类型");for(const s of e){null==(t=this.scrollInstance)||t.io.unobserve(s);const e=s.getAttribute(w),o=this.intersectionIoMap.get(e),r=this.singleBlockObMap.get(o.code);null==(i=null==(n=null==r?void 0:r.ids)?void 0:n.delete)||i.call(n,e),this.intersectionIoMap.delete(e)}}observe(e,t){if(!e)return;const{elements:n,section:i}=e;n||i?(n&&(Array.isArray(n)?n.forEach((n=>{this.singleBlock({...e,elements:n},t)})):this.singleBlock(e,t)),i&&i.length&&this.multiBlock(e,t),this.triggerScroll()):this.logFn("info","[basis-expose]: observe - 缺少元素|选择器")}update(e){if(!e)return this.logFn("warn","[basis-expose]: update - 方法缺少code");e.split(",").forEach((e=>{const t=this.singleBlockObMap.get(e);if(t){const{handle:e}=t;this.singleBlock(t,e)}})),this.triggerScroll()}remove(e){if(!e)return this.logFn("warn","[basis-expose]: remove - 方法缺少code");e.split(",").forEach((e=>{const t=this.singleBlockObMap.get(e);if(t){const n=t.ids;(null==n?void 0:n.size)>0&&n.forEach((e=>{this.intersectionIoMap.delete(e)})),this.singleBlockObMap.delete(e)}this.hasBeenExposeId.delete(e)}))}reset(e){if(!e)return this.logFn("warn","[basis-expose]: reset - 方法缺少code");const t=this.hasBeenExposeId.get(e);t&&(this.hasBeenExposeId.delete(e),[...t].forEach((t=>{const n=u(`[${w}="${t}"]`);if(!n)return;const i=this.singleBlockObMap.get(e);i&&this.singleBlock({...i,elements:{code:e,target:n}},i.handle)})),this.triggerScroll())}resetAll(e){var t;if(this.hasBeenExposeId.size>0){let n=[...this.hasBeenExposeId];e&&("function"==typeof e&&(n=e(n)),"string"==typeof e&&(n=null==(t=null==n?void 0:n.filter)?void 0:t.call(n,(t=>!!t.length&&t[0].startsWith(e))))),n.map((e=>e[0])).forEach((e=>{this.reset(e)}))}}destroy(){var e;null==(e=this.scrollInstance)||e.destroy();const t=c(this.initParams||{});t&&a.del(t)}triggerScroll(){var e;null==(e=this.scrollInstance)||e.triggerScroll()}}const k=e=>{const t=c(e||{});if(t){const e=a.get(t);if(e)return e}const n=new I(e);return t&&a.set(Object.assign(t,{instance:n})),n}}}]);
//# sourceMappingURL=99023-b3e4e24f15aaa39b.js.map